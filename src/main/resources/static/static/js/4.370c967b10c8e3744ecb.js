webpackJsonp([4],{La7A:function(t,e){},ePsb:function(t,e,s){"use strict";var n=s("BO1k"),r=s.n(n),i=s("d7EF"),o=s.n(i),a=s("mvHQ"),u=s.n(a),c=s("HUQg"),l=s("vMJZ"),d={name:"Chat",data:function(){return{msg:"",userInfo:null,userInfos:[],messages:[]}},components:{userInfoSmall:c.a},methods:{handleSendMessage:function(){var t={dstId:this.dstId,msg:this.msg};this.chatWebSocket.send(u()(t)),this.msg="",this.messages=this.$store.getters.messageGroup.get(this.dstId)},messageStyle:function(t){return{color:t?"blue":"green"}},updateMessages:function(){var t=this,e=this.$store.getters.messageGroup,s=[],n=!0,i=!1,a=void 0;try{for(var u,c=r()(e);!(n=(u=c.next()).done);n=!0){var d=u.value,h=o()(d,2),f=h[0];h[1];s.push(f)}}catch(t){i=!0,a=t}finally{try{!n&&c.return&&c.return()}finally{if(i)throw a}}Object(l.l)(s).then(function(e){t.userInfos=e}),this.dstId&&(this.messages=this.$store.getters.messageGroup.get(this.dstId))}},created:function(){this.peopleUserInfo&&(this.userInfo=this.peopleUserInfo),this.updateMessages()},computed:{userId:function(){return this.$store.getters.userId},chatWebSocket:function(){return this.$store.getters.chatWebSocket},dstId:function(){return this.userInfo?this.userInfo.user.userId:null},nickname:function(){return this.$store.getters.user.nickname},valueChange:function(){return this.$store.getters.valueChange}},watch:{dstId:function(t){t&&(this.messages=this.$store.getters.messageGroup.get(t))},valueChange:function(t){this.updateMessages()},messages:function(t){var e=this;setTimeout(function(){var t=e.$refs.messages;t.scrollTop=t.scrollHeight},500)}},props:["peopleUserInfo"]},h={render:function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticStyle:{width:"600px","background-color":"white",height:"600px"}},[s("div",{staticClass:"userInfos_div"},t._l(t.userInfos,function(e){return s("div",{key:e.user.userId,staticClass:"userInfos_div_div",on:{click:function(s){t.userInfo=e}}},[s("div",[s("userInfoSmall",{staticStyle:{"margin-top":"10px"},attrs:{userInfo:e}})],1)])}),0),t._v(" "),t.userInfo?s("el-card",{staticClass:"chat_card",attrs:{"body-style":{padding:"10px"}}},[s("div",{attrs:{slot:"header"},slot:"header"},[s("span",[t._v(t._s(t.userInfo.user.nickname))])]),t._v(" "),s("div",{ref:"messages",staticClass:"message_div"},t._l(t.messages,function(e,n){return s("div",{key:n},[s("div",{staticStyle:{"text-align":"left","margin-top":"10px"},style:t.messageStyle(e.dstId===t.userId)},[s("div",[t._v(t._s(e.dstId===t.userId?t.userInfo.user.nickname:t.nickname)+" "+t._s(t.$getTimeString(e.gmtCreate)))]),t._v(" "),s("div",[t._v(t._s(e.msg))])])])}),0),t._v(" "),s("div",{staticStyle:{"margin-top":"10px"}},[s("el-input",{staticStyle:{float:"left",width:"300px"},attrs:{placeholder:"聊天内容"},model:{value:t.msg,callback:function(e){t.msg=e},expression:"msg"}}),t._v(" "),s("el-button",{staticStyle:{float:"right"},on:{click:t.handleSendMessage}},[t._v("发送")])],1)]):t._e()],1)},staticRenderFns:[]};var f=s("VU/8")(d,h,!1,function(t){s("uWin")},"data-v-ffcae902",null);e.a=f.exports},j7e0:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=s("ePsb"),r=s("vMJZ"),i={data:function(){return{showChat:!1}},created:function(){var t=this;this.$store.commit("init"),this.userId&&Object(r.b)({peopleId:this.userId}).then(function(e){t.$store.commit("setUser",e.user)})},components:{Chat:n.a},methods:{login:function(){this.$router.push("/login")},handleLogout:function(){var t=this,e={sessionId:this.$store.getters.sessionId};Object(r.d)(e).then(function(e){console.log(e),t.$store.commit("logout")})},toPeople:function(){this.$router.push({path:"/people/"+this.userId})},toUpdate:function(){this.$router.push({path:"/setting"})},handleOpenChat:function(){this.$store.commit("readMessage"),this.showChat=!0},handleCloseChat:function(){this.$store.commit("closeMessage"),this.showChat=!1}},computed:{authority:function(){return this.$store.getters.authority},messageCount:function(){return this.$store.getters.messageCount},userId:function(){return this.$store.getters.userId},user:function(){return this.$store.getters.user},avaterUrl:function(){return this.$avaterUrl(this.user.avater,this.userId)}}},o={render:function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",[s("div",{staticClass:"home_header"},[s("div",{staticClass:"home_main"},[s("div",{staticClass:"home_queswer"},[t._v("问答社区")]),t._v(" "),s("el-dropdown",{staticClass:"home_user",attrs:{"show-timeout":0,trigger:"click"}},[null!=t.userId?s("span",{staticStyle:{float:"right",height:"50px"}},[s("el-badge",{attrs:{"is-dot":0!==t.messageCount}},[s("img",{staticClass:"home_avater",attrs:{src:t.avaterUrl}})]),t._v(" "),s("el-dropdown-menu",{staticStyle:{width:"100px","text-align":"center"}},[s("el-dropdown-item",{nativeOn:{click:function(e){return t.toPeople(e)}}},[t._v("个人主页")]),t._v(" "),s("el-dropdown-item",{nativeOn:{click:function(e){return t.handleOpenChat(e)}}},[s("el-badge",{attrs:{value:t.messageCount,max:99}},[t._v("消息")])],1),t._v(" "),s("el-dropdown-item",{attrs:{divided:""},nativeOn:{click:function(e){return t.toUpdate(e)}}},[t._v("设置")]),t._v(" "),s("el-dropdown-item",{nativeOn:{click:function(e){return t.handleLogout(e)}}},[t._v("注销")])],1)],1):s("span",[t._v("\n          未登录\n          "),s("el-dropdown-menu",[s("el-dropdown-item",{nativeOn:{click:function(e){return t.login(e)}}},[t._v("登陆")])],1)],1)]),t._v(" "),s("el-menu",{staticClass:"home_menu",attrs:{"default-active":t.$route.path,mode:"horizontal",router:""}},[t._l(t.$router.options.routes[0].children,function(e){return[e.hidden||e.authority&&!(e.authority<=t.authority)?t._e():s("el-menu-item",{key:e.path,attrs:{index:e.path}},[s("span",[t._v(t._s(e.name))]),t._v(" "),s("i",{class:e.iconCls})])]})],2)],1)]),t._v(" "),s("div",{staticClass:"home_main"},[s("transition",{attrs:{name:"fade",mode:"out-in"}},[s("router-view")],1)],1),t._v(" "),s("el-dialog",{staticClass:"chat_dialog",attrs:{visible:t.showChat,"before-close":t.handleCloseChat},on:{"update:visible":function(e){t.showChat=e}}},[t.showChat?s("Chat"):t._e()],1)],1)},staticRenderFns:[]};var a=s("VU/8")(i,o,!1,function(t){s("La7A")},null,null);e.default=a.exports},uWin:function(t,e){}});