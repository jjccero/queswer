webpackJsonp([5],{"3iTu":function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=s("vMJZ"),n=s("ePsb"),o=s("kX6x"),r={name:"people",data:function(){return{userInfo:null,loading:!1,subscribeQuestions:[],activityInfos:[],questionInfos:[],page:0,limit:10,colors:["#DD0000","brown","#0000DD","#48B753","#DDA522","green"],userInfos:[],tabindex:"0",firstLoadUserInfos:!1,firstLoadFollowerInfos:!1,showChat:!1}},components:{ActivityInfo:s("5KsW").a,Chat:n.a,UserInfoTable:o.a},created:function(){this.init()},methods:{init:function(){var t=this;null!=this.peopleId&&(this.userInfo=null,this.loading=!1,this.page=0,this.activityInfos=[],this.userInfos=[],this.firstLoadUserInfos=!1,this.firstLoadFollowerInfos=!1,Object(i.b)({peopleId:this.peopleId}).then(function(e){t.userInfo=e}))},load:function(){var t=this;if(!this.loading){this.loading=!0;var e={peopleId:this.peopleId,page:this.page,limit:this.limit};Object(i.i)(e).then(function(e){t.activityInfos=t.activityInfos.concat(e),++t.page,e.length<t.limit?(console.log("暂时没有更多了"),setTimeout(function(){t.loading=!1,console.log("冷却完成")},1e3)):t.loading=!1})}},handleFollow:function(){var t=this,e={peopleId:this.peopleId};this.userInfo.followed?Object(i.a)(e).then(function(e){!0===e&&(--t.userInfo.followersCount,t.userInfo.followed=!1)}):Object(i.n)(e).then(function(e){!0===e&&(++t.userInfo.followersCount,t.userInfo.followed=!0)})},handleSelect:function(t,e){this.tabindex=t},handleOpenChat:function(){this.$store.commit("readMessage"),this.showChat=!0},handleCloseChat:function(){this.$store.commit("closeMessage"),this.showChat=!1},handleUpdateAuthority:function(t){var e=this,s={userId:this.peopleId,authority:t};Object(i.p)(s).then(function(s){!0===s&&(e.userInfo.user.authority=t)})}},computed:{questionActivityInfos:function(){var t=this,e=[];return this.questionInfos.forEach(function(s){var i=t.$questionInfo2ActvityInfo(s);e.push(i)}),e},isSuperAdmin:function(){return 2===this.$store.getters.authority},avaterUrl:function(){return this.$avaterUrl(this.userInfo.user.avater,this.userInfo.user.userId)},userId:function(){return this.$store.getters.userId},sexStr:function(){if(this.isMe)return"我";switch(this.userInfo.user.sex){case 0:return"他";case 1:return"她";default:return"ta"}},peopleId:function(){return Number(this.$route.params.peopleId)},isMe:function(){return this.peopleId===this.userId},menu:function(){return["动态","回答","提问","订阅","关注"+this.sexStr+"的",this.sexStr+"关注的"]}},watch:{tabindex:function(t){var e=this,s={peopleId:this.peopleId};this.page=0,"1"===t?Object(i.f)(s).then(function(t){e.questionInfos=t}):"2"===t?Object(i.j)(s).then(function(t){e.questionInfos=t}):"3"===t?Object(i.k)(s).then(function(t){e.subscribeQuestions=t}):"4"===t?Object(i.h)(s).then(function(t){e.userInfos=t}):"5"===t?Object(i.m)(s).then(function(t){e.userInfos=t}):this.userInfos=[]},peopleId:function(t){this.init()}}},a={render:function(){var t=this,e=t.$createElement,s=t._self._c||e;return null!=t.userInfo?s("div",{staticStyle:{"text-align":"left"}},[s("div",{staticClass:"user_card",staticStyle:{"font-size":"15px"}},[s("div",{staticClass:"user_avater_border"},[s("img",{staticClass:"user_avater",attrs:{src:t.avaterUrl}})]),t._v(" "),s("div",{staticStyle:{width:"612px",float:"left",padding:"10px 0 10px"}},[s("el-dropdown",{staticStyle:{float:"right","margin-right":"20px"},attrs:{"show-timeout":0,trigger:"click"}},[s("span",[s("i",{staticClass:"el-icon-more",staticStyle:{color:"gray",cursor:"pointer","line-height":"50px"}})]),t._v(" "),s("el-dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},[t.isSuperAdmin&&1===t.userInfo.user.authority?s("el-dropdown-item",{nativeOn:{click:function(e){return t.handleUpdateAuthority(0)}}},[t._v("取消社区管理员")]):t._e(),t._v(" "),t.isSuperAdmin&&0===t.userInfo.user.authority?s("el-dropdown-item",{nativeOn:{click:function(e){return t.handleUpdateAuthority(1)}}},[t._v("设为社区管理员")]):t._e(),t._v(" "),s("el-dropdown-item",{nativeOn:{click:function(e){return t.handleFollow(e)}}},[t._v(t._s(t.userInfo.followed?"已":"")+"关注")]),t._v(" "),s("el-dropdown-item",{nativeOn:{click:function(e){return t.handleOpenChat(e)}}},[t._v("发消息")])],1)],1),t._v(" "),s("div",[s("div",{staticStyle:{float:"right","text-align":"center",width:"200px"}},[s("div",{staticClass:"follow_div",staticStyle:{width:"99px","border-right":"1px solid #ebebeb"}},[s("div",[t._v("关注"+t._s(t.sexStr))]),t._v(" "),s("el-tooltip",{attrs:{content:""+t.userInfo.followersCount,placement:"left-start"}},[s("b",{staticClass:"follow_div_b"},[t._v(t._s(t.userInfo.followersCount))])])],1),t._v(" "),s("div",{staticClass:"follow_div",staticStyle:{width:"100px"}},[s("div",[t._v(t._s(t.sexStr)+"关注")]),t._v(" "),s("el-tooltip",{attrs:{content:""+t.userInfo.followCount,placement:"right-start"}},[s("b",{staticClass:"follow_div_b"},[t._v(t._s(t.userInfo.followCount))])])],1)]),t._v(" "),s("b",{staticStyle:{"line-height":"50px",height:"50px","font-size":"30px"}},[t._v(t._s(t.userInfo.user.nickname))]),t._v(" "),s("div",{staticClass:"user_detail"},[s("div",{staticClass:"user_detail_value"},[t._v(t._s(t.userInfo.user.intro))])])])],1)]),t._v(" "),s("div",{staticClass:"activities_div_div user_card"},[s("div",{staticStyle:{"text-align":"center","border-bottom":"1px solid #ebebeb"}},[s("el-menu",{attrs:{"default-active":t.tabindex,mode:"horizontal"},on:{select:t.handleSelect}},t._l(t.menu,function(e,i){return s("el-menu-item",{key:i,attrs:{index:""+i}},[s("span",[t._v(t._s(e))])])}),1)],1),t._v(" "),s("div",{directives:[{name:"show",rawName:"v-show",value:"0"===t.tabindex,expression:"tabindex==='0'"},{name:"infinite-scroll",rawName:"v-infinite-scroll",value:t.load,expression:"load"}],staticClass:"activities_div",attrs:{"infinite-scroll-disabled":"loading"}},t._l(t.activityInfos,function(e,i){return s("div",{key:i},[s("ActivityInfo",{attrs:{activityInfo:e}}),t._v(" "),s("el-divider",{staticClass:"divider"})],1)}),0),t._v(" "),"1"===t.tabindex||"2"===t.tabindex?s("div",{staticClass:"activities_div"},t._l(t.questionActivityInfos,function(e,i){return s("div",{key:i},[s("ActivityInfo",{attrs:{activityInfo:e}}),t._v(" "),s("el-divider",{staticClass:"divider"})],1)}),0):t._e(),t._v(" "),"3"===t.tabindex?s("div",{staticClass:"activities_div"},t._l(t.subscribeQuestions,function(e,i){return s("div",{key:i},[s("ActivityInfo",{attrs:{activityInfo:e}}),t._v(" "),s("el-divider",{staticClass:"divider"})],1)}),0):t._e(),t._v(" "),"4"===t.tabindex||"5"===t.tabindex?s("div",[s("UserInfoTable",{attrs:{userInfos:t.userInfos}})],1):t._e()]),t._v(" "),s("el-dialog",{staticClass:"chat_dialog",attrs:{visible:t.showChat,"before-close":t.handleCloseChat},on:{"update:visible":function(e){t.showChat=e}}},[t.showChat?s("Chat",{attrs:{peopleUserInfo:t.userInfo}}):t._e()],1)],1):t._e()},staticRenderFns:[]};var l=s("VU/8")(r,a,!1,function(t){s("vC4f")},null,null);e.default=l.exports},ePsb:function(t,e,s){"use strict";var i=s("BO1k"),n=s.n(i),o=s("d7EF"),r=s.n(o),a=s("mvHQ"),l=s.n(a),u=s("HUQg"),c=s("vMJZ"),d={name:"Chat",data:function(){return{msg:"",userInfo:null,userInfos:[],messages:[]}},components:{userInfoSmall:u.a},methods:{handleSendMessage:function(){var t={dstId:this.dstId,msg:this.msg};this.chatWebSocket.send(l()(t)),this.msg="",this.messages=this.$store.getters.messageGroup.get(this.dstId)},messageStyle:function(t){return{color:t?"blue":"green"}},updateMessages:function(){var t=this,e=this.$store.getters.messageGroup,s=[],i=!0,o=!1,a=void 0;try{for(var l,u=n()(e);!(i=(l=u.next()).done);i=!0){var d=l.value,f=r()(d,2),h=f[0];f[1];s.push(h)}}catch(t){o=!0,a=t}finally{try{!i&&u.return&&u.return()}finally{if(o)throw a}}Object(c.l)(s).then(function(e){t.userInfos=e}),this.dstId&&(this.messages=this.$store.getters.messageGroup.get(this.dstId))}},created:function(){this.peopleUserInfo&&(this.userInfo=this.peopleUserInfo),this.updateMessages()},computed:{userId:function(){return this.$store.getters.userId},chatWebSocket:function(){return this.$store.getters.chatWebSocket},dstId:function(){return this.userInfo?this.userInfo.user.userId:null},nickname:function(){return this.$store.getters.user.nickname},valueChange:function(){return this.$store.getters.valueChange}},watch:{dstId:function(t){t&&(this.messages=this.$store.getters.messageGroup.get(t))},valueChange:function(t){this.updateMessages()},messages:function(t){var e=this;setTimeout(function(){var t=e.$refs.messages;t.scrollTop=t.scrollHeight},500)}},props:["peopleUserInfo"]},f={render:function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticStyle:{width:"600px","background-color":"white",height:"600px"}},[s("div",{staticClass:"userInfos_div"},t._l(t.userInfos,function(e){return s("div",{key:e.user.userId,staticClass:"userInfos_div_div",on:{click:function(s){t.userInfo=e}}},[s("div",[s("userInfoSmall",{staticStyle:{"margin-top":"10px"},attrs:{userInfo:e}})],1)])}),0),t._v(" "),t.userInfo?s("el-card",{staticClass:"chat_card",attrs:{"body-style":{padding:"10px"}}},[s("div",{attrs:{slot:"header"},slot:"header"},[s("span",[t._v(t._s(t.userInfo.user.nickname))])]),t._v(" "),s("div",{ref:"messages",staticClass:"message_div"},t._l(t.messages,function(e,i){return s("div",{key:i},[s("div",{staticStyle:{"text-align":"left","margin-top":"10px"},style:t.messageStyle(e.dstId===t.userId)},[s("div",[t._v(t._s(e.dstId===t.userId?t.userInfo.user.nickname:t.nickname)+" "+t._s(t.$getTimeString(e.gmtCreate)))]),t._v(" "),s("div",[t._v(t._s(e.msg))])])])}),0),t._v(" "),s("div",{staticStyle:{"margin-top":"10px"}},[s("el-input",{staticStyle:{float:"left",width:"300px"},attrs:{placeholder:"聊天内容"},model:{value:t.msg,callback:function(e){t.msg=e},expression:"msg"}}),t._v(" "),s("el-button",{staticStyle:{float:"right"},on:{click:t.handleSendMessage}},[t._v("发送")])],1)]):t._e()],1)},staticRenderFns:[]};var h=s("VU/8")(d,f,!1,function(t){s("uWin")},"data-v-ffcae902",null);e.a=h.exports},uWin:function(t,e){},vC4f:function(t,e){}});