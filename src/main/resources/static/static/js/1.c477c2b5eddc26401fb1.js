webpackJsonp([1],{"0u7c":function(e,t){},"5zde":function(e,t,n){n("zQR9"),n("qyJz"),e.exports=n("FeBl").Array.from},D9PO:function(e,t,n){"use strict";var s=n("mvHQ"),i=n.n(s),o=n("Gu7T"),r=n.n(o),a=n("Ozlq"),u={name:"SaveQuestion",data:function(){return{topic:"",inputVisible:!1,questionForm:{title:"",detail:"",anonymous:!1,topics:[]},questionRules:{title:[{required:!0,message:"问题标题不能为空"}]}}},created:function(){if(this.hasQuestion){var e=this.question,t=this.questionForm;t.title=e.title,t.detail=e.detail,t.topics=[].concat(r()(e.topics))}},methods:{handleSaveQuestion:function(){var e=this;this.$refs.questionForm.validate(function(t){if(t){var n=JSON.parse(i()(e.questionForm));Object(a.e)(n).then(function(t){t>0&&e.$router.push({path:"/question",query:{questionId:t}})})}})},handleUpdateQuestion:function(){var e=this;this.$refs.questionForm.validate(function(t){if(t){var n=JSON.parse(i()(e.questionForm));n.questionId=e.question.questionId,Object(a.g)(n).then(function(t){!0===t&&e.$emit("updateQuestion",n)})}})},showInput:function(){var e=this;this.inputVisible=!0,this.$nextTick(function(t){e.$refs.topic.$refs.input.focus()})},handleSaveTopic:function(){var e=this.topic.trim();""!=e&&this.questionForm.topics.push(e),this.topic="",this.inputVisible=!1},handleDeleteTopic:function(e){var t=this.questionForm.topics;t.splice(t.indexOf(e),1)}},computed:{hasQuestion:function(){return null!=this.question}},props:["question"]},l={render:function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",[n("el-form",{ref:"questionForm",staticClass:"questionForm",attrs:{model:e.questionForm,rules:e.questionRules,"label-width":"100px","label-position":"left"}},[n("el-form-item",{attrs:{label:"标题",prop:"title"}},[n("el-input",{model:{value:e.questionForm.title,callback:function(t){e.$set(e.questionForm,"title",t)},expression:"questionForm.title"}})],1),e._v(" "),n("el-form-item",{attrs:{label:"问题描述",prop:"detail"}},[n("el-input",{attrs:{type:"textarea"},model:{value:e.questionForm.detail,callback:function(t){e.$set(e.questionForm,"detail",t)},expression:"questionForm.detail"}})],1),e._v(" "),n("el-form-item",{attrs:{label:"匿名提问",prop:"anonymous"}},[n("el-switch",{model:{value:e.questionForm.anonymous,callback:function(t){e.$set(e.questionForm,"anonymous",t)},expression:"questionForm.anonymous"}})],1),e._v(" "),n("el-form-item",{attrs:{label:"话题",prop:"topics"}},[e._l(e.questionForm.topics,function(t){return n("el-tag",{key:t,staticStyle:{"margin-right":"10px"},attrs:{closable:""},on:{close:function(n){return e.handleDeleteTopic(t)}}},[e._v(e._s(t))])}),e._v(" "),e.inputVisible?n("el-input",{ref:"topic",staticClass:"topic_input",attrs:{size:"small"},on:{blur:e.handleSaveTopic},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.handleSaveTopic(t)}},model:{value:e.topic,callback:function(t){e.topic=t},expression:"topic"}}):e.questionForm.topics.length<5?n("el-button",{attrs:{size:"small"},on:{click:e.showInput}},[e._v("+ 话题")]):e._e()],2),e._v(" "),e.hasQuestion?n("el-button",{attrs:{type:"primary"},on:{click:e.handleUpdateQuestion}},[e._v("修改问题")]):n("el-button",{attrs:{type:"primary"},on:{click:e.handleSaveQuestion}},[e._v("提问")])],1)],1)},staticRenderFns:[]};var c=n("VU/8")(u,l,!1,function(e){n("0u7c")},"data-v-c51e701e",null);t.a=c.exports},Gu7T:function(e,t,n){"use strict";t.__esModule=!0;var s,i=n("c/Tr"),o=(s=i)&&s.__esModule?s:{default:s};t.default=function(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return(0,o.default)(e)}},NtIj:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=n("Ozlq"),i=n("Muk+"),o=n("XOjX"),r=n("yw6p"),a=n("V7I/"),u={name:"answer",components:{userInfo:r.a,attitude:a.a},data:function(){return{answer:this.answerInfo.answer}},created:function(){},methods:{handleDeleteAnswer:function(){this.$emit("handleDeleteAnswer")},preAnswer:function(){this.$emit("preAnswer")}},computed:{isAdmin:function(){return this.$store.getters.authority>1}},props:["answerInfo","answered","questioned"]},l={render:function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",[n("div",[n("userInfo",{attrs:{userInfo:e.answerInfo.userInfo}})],1),e._v(" "),n("div",{staticClass:"answer",domProps:{innerHTML:e._s(e.answer.ans)}}),e._v(" "),n("div",{staticClass:"gmt_create",staticStyle:{"margin-top":"10px"}},[e._v("\n    回答于\n    "+e._s(e.$getTimeString(null!=e.answer.gmtModify?e.answer.gmtModify:e.answer.gmtCreate))+"\n  ")]),e._v(" "),n("div",{staticStyle:{"margin-top":"10px"}},[n("attitude",{attrs:{answerInfo:e.answerInfo}}),e._v(" "),n("span",{staticStyle:{"margin-left":"10px"}},[e.answered?n("el-button",{staticStyle:{color:"gray"},attrs:{type:"text",icon:"el-icon-edit-outline"},on:{click:e.preAnswer}},[e._v("修改")]):e._e(),e._v(" "),e.answered||e.isAdmin?n("el-button",{staticStyle:{color:"red"},attrs:{type:"text",icon:"el-icon-delete"},on:{click:e.handleDeleteAnswer}},[e._v("删除")]):e._e()],1)],1),e._v(" "),n("el-divider",{staticClass:"divider"})],1)},staticRenderFns:[]};var c=n("VU/8")(u,l,!1,function(e){n("o0Z6")},null,null).exports,d=n("D9PO"),f={data:function(){return{questionInfo:{questionId:this.$route.query.questionId,question:{anonymous:!1,title:null,detail:null,gmtCreate:0,gmtModify:null,userId:null,topics:[]},subscribed:!1,subscribeCount:0,viewCount:0,questioned:!1,defaultAnswer:null,userAnswer:null},answerSet:{},answerInfos:[],answer:{userId:null,questionId:null,answerId:null,ans:null,anonymous:!1,gmtCreate:0,gmtModify:null},showAnswerDrawer:!1,showQuestion:!1}},components:{Answer:c,UserInfo:r.a,SaveQuestion:d.a,TopicTag:o.a},created:function(){var e=this,t=this.$route.query.questionId;null!=t&&Object(s.c)({questionId:t,answerId:this.$route.query.answerId}).then(function(t){e.questionInfo=t,null!=e.questionInfo.userAnswer&&(e.answer=e.questionInfo.userAnswer.answer),Object(i.c)({questionId:e.$route.query.questionId}).then(function(t){for(var n=t,s=e.answerInfos.length,i=0;i<n.length;++i){var o=n[i];if(null!=e.questionInfo.defaultAnswer&&o.answer.answerId===e.questionInfo.defaultAnswer.answer.answerId)e.questionInfo.defaultAnswer=o;else if(null!=e.questionInfo.userAnswer&&o.answer.answerId===e.questionInfo.userAnswer.answer.answerId)e.questionInfo.userAnswer=o;else{var r=""+o.answer.answerId;e.answerSet.hasOwnProperty(r)?e.answerInfos[e.answerSet[r]]=o:(e.answerInfos.push(o),e.answerSet[r]=s++)}}})})},methods:{handleSubscribe:function(){var e=this,t={questionId:this.$route.query.questionId};0==this.questionInfo.subscribed?Object(s.f)(t).then(function(t){!0===t?(e.$message({showClose:!0,message:"关注成功",type:"success"}),e.questionInfo.subscribed=!0,++e.questionInfo.subscribeCount):e.$message({showClose:!0,message:"已关注",type:"error"})}):Object(s.b)(t).then(function(t){!0===t?(e.$message({showClose:!0,message:"取消关注成功",type:"success"}),e.questionInfo.subscribed=!1,--e.questionInfo.subscribeCount):e.$message({showClose:!0,message:"已取消关注",type:"error"})})},handleDeleteAnswer:function(){var e=this,t={answerId:this.answer.answerId};Object(i.a)(t).then(function(t){!0===t&&(e.questionInfo.userAnswer=null,e.answer.answerId=null,e.$message({showClose:!0,message:"删除成功",type:"success"}))})},handleAnswer:function(){var e=this;this.answer.userId=this.userId,this.answer.questionId=this.questionInfo.question.questionId,null!=this.answer.answerId?Object(i.e)(this.answer).then(function(t){!0===t&&(e.answer.gmtModify=e.$nowTimestamp(),e.questionInfo.userAnswer.answer=e.answer,e.questionInfo.userAnswer.userInfo=e.$userInfo(e.answer.anonymous),e.showAnswerDrawer=!1)}):Object(i.d)(this.answer).then(function(t){var n=Number(t);if(n>0){e.answer.answerId=n,e.answer.gmtCreate=e.$nowTimestamp();var s={answer:e.answer,against:0,agree:0,attituded:null,userInfo:e.$userInfo(e.answer.anonymous)};e.questionInfo.userAnswer=s,e.showAnswerDrawer=!1}})},updateQuestion:function(e){this.questionInfo.question=e,this.showQuestion=!1},handleDeleteQuestion:function(){var e=this,t={questionId:this.$route.query.questionId};Object(s.a)(t).then(function(t){!0===t&&e.$router.push({path:"/"})})}},computed:{userId:function(){return this.$store.getters.userId},isAdmin:function(){return this.$store.getters.authority>1}}},w={render:function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticStyle:{"text-align":"left"}},[n("div",{staticStyle:{float:"left"}},e._l(e.questionInfo.question.topics,function(e){return n("TopicTag",{key:e,attrs:{topic:e}})}),1),e._v(" "),n("div",{staticStyle:{float:"right"}},[e.questionInfo.subscribed?n("el-button",{attrs:{type:"text",icon:"el-icon-star-on"},on:{click:e.handleSubscribe}}):n("el-button",{attrs:{type:"text",icon:"el-icon-star-off"},on:{click:e.handleSubscribe}}),e._v(" "),n("el-button",{staticClass:"subscribe_btn",staticStyle:{"margin-left":"0"},attrs:{type:"text"}},[e._v(e._s(e.questionInfo.subscribeCount))]),e._v(" "),n("el-divider",{attrs:{direction:"vertical"}}),e._v(" "),n("i",{staticClass:"el-icon-view"}),e._v(" "),n("span",{staticClass:"viewed"},[e._v(e._s(e.questionInfo.viewCount))]),e._v(" "),n("el-divider",{attrs:{direction:"vertical"}}),e._v(" "),e.isAdmin?n("el-button",{attrs:{type:"text"},on:{click:function(t){e.showQuestion=!0}}},[e._v("修改问题")]):e._e(),e._v(" "),e.isAdmin?n("el-button",{attrs:{type:"text"},on:{click:e.handleDeleteQuestion}},[e._v("删除问题")]):e._e(),e._v(" "),n("el-button",{attrs:{type:"text",icon:"el-icon-edit"},on:{click:function(t){e.showAnswerDrawer=!0}}},[e._v("回答")])],1),e._v(" "),n("h1",{staticStyle:{clear:"both"}},[e._v(e._s(e.questionInfo.question.title))]),e._v(" "),n("div",{staticStyle:{color:"gray","font-size":"10px","margin-top":"10px"}},[e._v("问题描述：")]),e._v(" "),n("div",{domProps:{innerHTML:e._s(e.questionInfo.question.detail)}}),e._v(" "),null!=e.questionInfo.defaultAnswer||null!=e.questionInfo.userAnswer?n("el-card",{staticStyle:{"margin-top":"10px"},attrs:{"body-style":{padding:"10px"}}},[null!=e.questionInfo.defaultAnswer?n("div",[n("answer",{attrs:{answerInfo:e.questionInfo.defaultAnswer,answered:!1,questioned:e.questionInfo.questioned},on:{handleDeleteAnswer:e.handleDeleteAnswer}})],1):e._e(),e._v(" "),null!=e.questionInfo.userAnswer?n("div",[n("answer",{attrs:{answerInfo:e.questionInfo.userAnswer,answered:!0,questioned:e.questionInfo.questioned},on:{handleDeleteAnswer:e.handleDeleteAnswer,preAnswer:function(t){e.showAnswerDrawer=!0}}})],1):e._e()]):e._e(),e._v(" "),n("el-card",{attrs:{"body-style":{padding:"10px"}}},[n("el-divider",{staticClass:"divider"},[e._v(e._s(0===e.answerInfos.length?"暂无其他回答":"更多"+e.answerInfos.length+"个回答"))]),e._v(" "),e._l(e.answerInfos,function(t){return[n("div",{key:t.answer.answerId,staticStyle:{"text-align":"left"}},[n("answer",{attrs:{answerInfo:t,answered:!1,questioned:e.questionInfo.questioned}})],1)]})],2),e._v(" "),n("el-drawer",{staticStyle:{"text-align":"center"},attrs:{visible:e.showAnswerDrawer,size:"70%",direction:"btt"},on:{"update:visible":function(t){e.showAnswerDrawer=t}}},[n("div",[n("el-input",{staticClass:"question_input",attrs:{type:"textarea",placeholder:"请输入回答",autosize:{minRows:8,maxRows:10}},model:{value:e.answer.ans,callback:function(t){e.$set(e.answer,"ans",t)},expression:"answer.ans"}})],1),e._v(" "),n("div",[n("el-checkbox",{model:{value:e.answer.anonymous,callback:function(t){e.$set(e.answer,"anonymous",t)},expression:"answer.anonymous"}},[e._v("开启匿名")]),e._v(" "),n("el-button",{attrs:{type:"primary"},on:{click:e.handleAnswer}},[e._v("提交")])],1)]),e._v(" "),n("el-dialog",{attrs:{visible:e.showQuestion},on:{"update:visible":function(t){e.showQuestion=t}}},[e.showQuestion?n("SaveQuestion",{attrs:{question:e.questionInfo.question},on:{updateQuestion:e.updateQuestion}}):e._e()],1)],1)},staticRenderFns:[]};var p=n("VU/8")(f,w,!1,function(e){n("lZop")},null,null);t.default=p.exports},X2bF:function(e,t){},XOjX:function(e,t,n){"use strict";var s={render:function(){var e=this.$createElement;return(this._self._c||e)("el-tag",{staticClass:"topic",on:{click:this.toTopic}},[this._v(this._s(this.topic))])},staticRenderFns:[]};var i=n("VU/8")({name:"TopicTag",props:["topic"],methods:{toTopic:function(){this.$router.push({path:"/topic/"+this.topic})}}},s,!1,function(e){n("X2bF")},"data-v-6c3974c2",null);t.a=i.exports},"c/Tr":function(e,t,n){e.exports={default:n("5zde"),__esModule:!0}},fBQ2:function(e,t,n){"use strict";var s=n("evD5"),i=n("X8DO");e.exports=function(e,t,n){t in e?s.f(e,t,i(0,n)):e[t]=n}},lZop:function(e,t){},o0Z6:function(e,t){},qyJz:function(e,t,n){"use strict";var s=n("+ZMJ"),i=n("kM2E"),o=n("sB3e"),r=n("msXi"),a=n("Mhyx"),u=n("QRG4"),l=n("fBQ2"),c=n("3fs2");i(i.S+i.F*!n("dY0y")(function(e){Array.from(e)}),"Array",{from:function(e){var t,n,i,d,f=o(e),w="function"==typeof this?this:Array,p=arguments.length,h=p>1?arguments[1]:void 0,v=void 0!==h,m=0,q=c(f);if(v&&(h=s(h,p>2?arguments[2]:void 0,2)),void 0==q||w==Array&&a(q))for(n=new w(t=u(f.length));t>m;m++)l(n,m,v?h(f[m],m):f[m]);else for(d=q.call(f),n=new w;!(i=d.next()).done;m++)l(n,m,v?r(d,h,[i.value,m],!0):i.value);return n.length=m,n}})}});